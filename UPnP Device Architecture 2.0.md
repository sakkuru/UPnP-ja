 http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v2.0.pdf
 の適当翻訳。

# UPnP Device Architecture 2.0

Document Revision Date: Febraury 20, 2015

# UPnP技術とは？

UPnP技術は、あらゆる形状のインテリジェントな電気機器、無線デバイス、PCなどの広く普及したP2Pネットワーク接続のためのアーキテクチャを定義する。
これは家庭や中小企業、公共スペースか、インターネットに接続されているにかかわらず、使いやすく、フレキシブルで、標準に基づいたアドホックもしくは制御のいらないネットワークへの接続をもたらすようデザインされている。

UPnP技術は、シームレス近接ネットワーク、さらに制御とネットワーク機器間のデータ転送を可能にするため、TCP/IPとWeb技術を利用する、分散されたオープンネットワークアーキテクチャを提供する。

UPnP Device Architecture (UDA) は、 プラグアンドプレイ周辺機器モデルのただの単純な拡張
を超えるものである。
それは、zero-configuration("invisible"ネットワーク）や、広範なベンダーの幅広いデバイスカテゴリのための自動検出をサポートするよう設計されている。
これはデバイスは動的にネットワークにjoinし、IPアドレスを取得し、自身の機能を伝え、他のデバイスの存在と機能を学ぶことができることを意味する。
最後にデバイスは、不必要な状態を残さずにネットワークをスムーズにかつ自動的に去る。


UPnPアーキテクチャの影響下にある技術は、IP、TCP、UDP、HTTPやXMLなどのインターネットプロトコルを含む。
インターネットのように、協定は宣言的でXMLで表現され、HTTPをつかって通信する有線プロトコルを元にしている。
異なる物理メディアへ広がり、実世界のマルチベンダの相互運用を可能にし、インターネットと多くの家やオフィスのイントラネットの相乗効果を得る、その証明された能力ゆえ、インターネットプロトコルの使用は、UDAのための強力な選択である。
UPnPアーキテクチャはそれらの環境に適用するよう明確に設計されていた。
さらに、コスト、技術、レガシーが、メディアやデバイスを現行ののIPに接続することを妨害しているとき、ブリッジングを通して、UDAはnon-IPプロトコルで動いているメディアに適用する。

UPnP技術についての"universal"とはなんだろうか。
No device drivers; 一般的なプロトコルが代わりに使われる。
UPnPデバイスはいくつものプログラミング言語やいくつものOS上でで実装されるだろう。
UPnP技術はアプリケーションのためのAPIの設計を仕様に含めたり、強要したりしない;
OSベンダーはカスタマーのニーズに合わせてAPIを作ることができる。



## UPnPフォーラム

UPnPフォーラムは多くの異なるベンダーのスタンドアロンデバイスやPC間の、簡単で強固な接続を可能にするよう設計されたindustry initiativeである。
UPnPフォーラムは、device-to-deviceの相互運用性をスケーラブルにネットワークで繋がった環境で可能にするため、XMLベースのデバイススキーマとデバイスプロトコルを表すための標準を開発しようとしている。

UPnPフォーラムは多くの産業を横断したメンバ企業からなっている。


## In this document

ここで書かれているUPnPデバイスアーキテクチャ（かつてはDCPフレームワークで知られた）は、コントローラやコントロールポイント、デバイス間の通信のためのプロトコルを定義する。
discovery、description、control、eventingやpresentationのため、UPnPデバイスアーキテクチャは下記のプロトコルスタックを使用する（表示された色やスタイルは本ドキュメント中でそれぞれのプロトコル要素が定義されている場所を示している）。


<table>
<tr><td colspan="4">UPnP vendor</td></tr>
<tr><td colspan="4">UPnP Forum</td></tr>
<tr><td colspan="4">UPnP Device Architecture</td></tr>
<tr><td rowspan="2">SSDP</td><td rowspan="2">Multicast events</td><td>SOAP</td><td>GENA</td></tr>
<tr><td>HTTP</td><td>HTTP</td></tr>
<tr><td colspan="2">UDP</td><td colspan="2">TCP</td></tr>
<tr><td colspan="4">IP</td></tr>
</table>

最上位層では、


## Glossary

### action

サービスにより提供されているコマンド。
一つ以上の入出力引数を取る。
戻り値を持つこともある。
詳しくは節2「ディスクリプション」 と節3「コントロール」を参照。

### argument

サービスにより提供されているアクションのためのパラメータ。
inかout。
詳しくは節2「ディスクリプション」と節3「コントロール」を参照。


### control point

デバイスおよびサービスディスクリプションを取り出し、サービスにアクションを送信し、サービスの状態変数をポーリングし、サービスからイベントを受信する。

### device

論理的なデバイス。
コンテナ。
他のデバイスを埋め込んでいることもある。
一つ以上のサービスを埋め込んでいる。
自身のプレゼンスをネットワーク上に広告する。
詳しくは節1「ディスカバリ」と、節2「ディスクリプション」を参照。

### device description

論理デバイスのフォーマルな定義、UPnPテンプレート弦をにより表現される。
XML構文で書かれる。
UPnPデバイステンプレート内のプレースホルダを埋めることでUPnPベンダによって書かれる。
例えばメーカ名、モデル名、モデルナンバー、シリアルナンバーやコントロール、イベント、プレゼンテーションのためのURLなどを含む。
詳しくは節2「ディスプリプション」を参照。


### device type

標準的なデバイスタイプは、urn:schemas-upnp-org:device:で表される。この後にはUPnPForumワーキング委員会によって割り当てられるユニークな名前が続く。
UPnPデバイステンプレートと一対一の関係。
UPnPベンダは追加のデバイスタイプを規定できる; これらはurn:domain-name:device:で表される。この後にはベンダによって割り当てられるユニークな名前が続く。
domain-nameはベンダードメイン名である。
詳しくは節2「ディスプリプション」を参照。


### event

サービスによって提供される状態変数の一つ以上の変化の通知。
詳しくは節4「イベント」を参照。


### GENA

General Event Notification Architecture。
節4「イベント」で定義される、イベント購読と通知のプロトコル。


### publisher

イベントメッセージ元。
通常はデバイスのサービス。
詳しくは節4「イベント」を参照。

### root device

他の論理デバイスの中に埋め込まれていない論理デバイス。
詳しくは節2「ディスクリプション」を参照。
### service

### service description

論理的な機能単位。
コントロールの最も小さい単位。
アクションを提供し、状態変数で物理デバイスの状態を表す。
詳しくは節3「コントロール」を参照。

### service type
標準的なサービスタイプは、urn:schemas-upnp-org:service:で表される。この後にはUPnPForumワーキング委員会によって割り当てられるユニークな名前、コロン、バージョンナンバーが続く。
UPnPサービステンプレートと一対一の関係。
UPnPベンダは追加のサービスタイプを規定できる; これらはurn:domain-name:service:で表される。この後にはベンダによって割り当てられるユニークな名前が続く。
domain-nameはベンダードメイン名である。
詳しくは節2「ディスプリプション」を参照。


### SOAP

Simple Object Access Protocol。
XMLに基づいたリモートプロシージャコールのメカニズム。HTTP上でコマンドを送り、値を受け取る。
詳しくは節3「コントロール」を参照。

### SSDP

Simple Service Discovery Protocol。
マルチキャストディスカバリ、サーチメカニズム。
マルチキャスト版のHTTP over UDPを使用する。
詳しくは節3「コントロール」を参照。

### state variable

物理サービスを表現する一面。
サービスにより提供される。
名前、データ型、任意のデフォルト値、任意の制約値を持ち、値が変わった際はイベントを引き起こすことができる。
詳しくは節2「ディスクリプション」と節3「コントロール」を参照。

### subscriber

イベントメッセージの受信者。
通常はコントロールポイント。
詳しくは節4「イベント」を参照。

### UPnP Device Template

デバイスタイプをリストしたテンプレート。(もしあれば)埋め込まれたデバイスが要求され、サービスが必須となる。
XML構文で書かれ、UPnPデバイススキーマから派生している。
UPnPフォーラムワーキング委員会により定義される。
標準的なデバイスタイプと一対一の関係。
詳しくは節2「ディスクリプション」を参照。

### UPnP Service Template

アクション名、それらアクションのパラメータ、状態変数、そしてそれらの状態変数のプロパティをリストしたテンプレート。
XML構文で書かれ、UPnPサービススキーマから派生している。
UPnPフォーラムワーキング委員会により定義される。
標準的なサービスsタイプと一対一の関係。
詳しくは節2「ディスクリプション」を参照。


### UPnP Device Schema

UPnPデバイスとサービステンプレートで使用される要素と属性を定義する。
XML構文で書かれ、XMLスキーマ(Part1: 構造、Part2: データタイプ)から派生している。
このUPnPデバイスアーキテクチャで定義されている。
詳しくは節2「ディスクリプション」を参照。

### Vendor Domain Name

ベンダから提供されるドメイン名。
ベンダにより所有され、ICANNが認定したレジストラにより登録されたもので、ユニークであるものとする。
ベンダはドメイン名登録を最新にし続けるものとする。
ベンダドメイン名長は、UDA内のドメイン名の使用と互換性があるように選択されるべきである。

### References and resources 

RFC 2710, Multicast Listener Discovery for IPv6. 
http://www.ietf.org/rfc/rfc2710.txt.

RFC 2616, HTTP: Hypertext Transfer Protocol 1.1. 
http://www.ietf.org/rfc/rfc2616.txt.

RFC 2279, UTF-8, a transformation format of ISO 10646 (character encoding). 
http://www.ietf.org/rfc/rfc2279.txt.

XML, Extensible Markup Language. W3C recommendation. 
http://www.w3.org/XML/.

DEVICEPROTECTION, UPnP Device Protection specification. 
http://upnp.org/specs/gw/UPnP-gw-DeviceProtection-v1-Service.pdf.

本ドキュメントの各節は、特定のトピックのリソースについて追加の情報を含む。


## 0 Adressing

アドレッシングはUPnPネットワーキングのステップ0である。
アドレッシングによって、デバイスとコントロールポイントはネットワークアドレスを取得する。



### 0.1 Auto-IPを使うべきどうかの決定

### 0.2 アドレス選択

### 0.3 アドレスのテスト

### 0.4 ルールの転送


### 0.5 動的アドレスが使用可能か定期的なチェック

### 0.6 デバイスネーミングとDNSインタラクション

### 0.7 IPアドレス解決の名前

### 0.8 リファレンス

## 1 ディスカバリ

### 1.1 SSDPメッセージフォーマット

SSDPは、RFC 2616で定義されているHTTP 1.1のヘッダフィールドフォーマットの一部を使用する。
しかし、これはTCPの代わりにUDPを使用したり、自身のプロセスルールを持っていたりするように、完全にHTTP 1.1に基づいているわけではない。

すべてのSSDPメッセージはRFC 2616 4.1節 "generic message"に従った書式であるものとする。
SSDPメッセージは1つのスタートラインと、メッセージヘッダフィールドのリストを持っているものとする。
SSDPメッセージはメッセージボディを持っているべきではない。
もしメッセージボディがあるSSDPメッセージを受信しても、メッセージボディは無視してもよい。

#### 1.1.1 SSDP スタートライン

SSDPメッセージそれぞれは、1つのスタートラインを持つものとする。
すべてのSSDPメッセージ候補の定義のために、1.2節"Advertisement"と、1.3節"Search"を参照せよ。
スタートラインはRFC 2616の節5.1か節6.1で定義されているようにフォーマットされているものとする。
また、スタートラインは以下の3つのうちの1つであるとする。

NOTIFY * HTTP/1.1\r\n
M-SEARCH * HTTP/1.1\r\n
HTTP/1.1 200 OK\r\n

明確化のため、スタートラインが"HTTP/1.1"を含むとはいえ、これはSSDPがすべてHTTP 1.1に基づいていることを示しているわけではない。
このスタートライン要素は後方互換性のためだけに含まれる。

#### 1.1.2 SSDPメッセージヘッダフィールド

SSDPメッセージのメッセージヘッダフィールドはRFC 2615の4.2節に従ってフォーマットされることとする。
これは、コロン(":")が続く大文字小文字を区別しないフィールドネームと、その後の大文字小文字を区別しないフィールド値からなる、それぞれのメッセージフィールドを指定する。
SSDPは許可するフィールド値を制限する。

SSDPヘッダの例:

HOST: 239.255.255.250:1900

#### 1.1.3 SSDPヘッダフィールド拡張

UPnPワーキング委員会とUPnPベンダは、追加のSSDPヘッダフィールドによるSSDPメッセージの拡張を許可されている。
追加のメッセージヘッダフィールはまた、UPnP Forum Technical committeeによって定義されることもある（例: 節1.2"Advertisement"は、BOOTID.UPNP.ORG, CONFIGID.UPNP.ORG, NEXTBOOTID.UPNP.ORG, SEARCHPORT.UPNP.ORGヘッダフィールドを定義する）。
ヘッダフィールド定義の名前衝突（2つのパーティが偶然、異なる意味論を持つ同じヘッダフィールド名を定義する）を防ぐため、ベンダー定義のヘッダフィールドネームは以下のフォーマットを持つこととする:

```
field-name = token "." domain-name
```

 domain-nameはベンダードメイン名であるとし、さらにRFC 2616の節2.2で定義されているトークンフォーマットを満たすものとする。


ベンダー定義のSSDPヘッダフィールドの例:

```
myheader.philips.com: "some value"
myheader.sony.com: "other value"
```

#### 1.1.4 UUIDフォーマットと推奨される生成アルゴリズム

UPnP 2.0デバイスは、以下で指定されるフォーマットに従うUUIDのフォーマットするものとする。
しかし、UPnP 2.0コントロールポイントはまた、下記で示されるルールに従ってフォーマットされていないUUID（UUIDが文字列であるという要件以外で、UPnP 1.0で指定されないルールでフォーマットされているような）も受け入れることができるものとする。

UUIDは、以下の文法によって示されるようにフォーマットされているものとする、128bitの数字である。

```
UUID = 4 * <hexOctet> "-" 2 * <hexOctet> "-" 2 * <hexOctet> "-" 2 * <hexOctet> "-" 6 * <hexOctet>
hexOctet = <hexDigit> <hexDigit>
hexDigit = "0"|"1"|"2"|"3"|"4"|"5"|"6"|"7"|"8"|"9"|"a"|"b"|"c"|"d"|"e"|"f"|"A"|"B"|"C"|"D"|"E"|"F"
```

下記はUUIDの文字列表現の例である。

"2fac1234-31f8-11b4-a222-08002b34c003"


UUIDは、以下の要件を満たすいかなるふさわしい生成アルゴリズムを使用して生成されることも許可されている。

a) ある他のリソースから生成されたUUIDと重複する可能性は極めて低い。
b) 128bitの数字になるまで計画する。
c) UUIDは長い間固定のままである。

以下のUUID生成アルゴリズムが推奨される:

[1]に記載されている時間とMACベースのアルゴリズム。これによりUUIDが一度生成され、可能であれば非揮発性のメモリに記憶される。


#### 1.1.5 SSDPプロセスルール

節1.1 "SSDPメッセージフォーマット"に従ってフォーマットされていないSSDPメッセージを受信した場合、受信者はそのメッセージを黙って破棄すべきである。
受信者は相互運用しようと、そのようなSSDPメッセージのパースを試みることもできる。


SSDPヘッダフィールドをパースするとき、受信者はすべての必須SSDP定義済みヘッダフィールドをパースするものとし、他のすべてのヘッダフィールドはスキップすることができる。
受信者は理解できないヘッダフィールドをスキップすることができる。


### 1.2 広告